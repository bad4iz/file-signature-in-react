(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{403:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.extract=exports.signFile=void 0;var _cryptoProCadesplugin2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(238));var toBase64=function toBase64(file){return new Promise((function(resolve,reject){var reader=new FileReader;reader.readAsDataURL(file),reader.onload=function(){return resolve(reader.result)},reader.onerror=function(error){return reject(error)}}))};function b64toBlob(b64Data){for(var contentType=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",sliceSize=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,byteCharacters=atob(b64Data),byteArrays=[],offset=0;offset<byteCharacters.length;offset+=sliceSize){for(var slice=byteCharacters.slice(offset,offset+sliceSize),byteNumbers=new Array(slice.length),i=0;i<slice.length;i++)byteNumbers[i]=slice.charCodeAt(i);var byteArray=new Uint8Array(byteNumbers);byteArrays.push(byteArray)}return new Blob(byteArrays,{type:contentType})}exports.signFile=(_ref=function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise((function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then((function(value){step("next",value)}),(function(err){step("throw",err)}));resolve(value)}("next")}))}}(regeneratorRuntime.mark((function _callee(_ref2){var header,sFileData,sBase64Data,type,certsApi,sign,contentType,blob,_ref2$file=_ref2.file,file=void 0===_ref2$file?null:_ref2$file,thumbprint=_ref2.thumbprint;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!file){_context.next=16;break}return header=";base64,",_context.next=4,toBase64(file);case 4:return sFileData=_context.sent,sBase64Data=sFileData.substr(sFileData.indexOf(header)+header.length),type=sFileData.substr(0,sFileData.indexOf(header)),_context.next=9,_cryptoProCadesplugin2.default;case 9:return certsApi=_context.sent,_context.next=12,certsApi.signBase64(thumbprint,sBase64Data);case 12:return sign=_context.sent,contentType=type.split(":")[1],blob=b64toBlob(sign,contentType),_context.abrupt("return",{blob:blob,fileName:file.name+".sig"});case 16:return _context.abrupt("return",{blob:null,fileName:null});case 17:case"end":return _context.stop()}}),_callee,void 0)}))),function signFile(_x3){return _ref.apply(this,arguments)});var _ref,checkQuotes=function checkQuotes(str){for(var result=0,i=0;i<str.length;i++)'"'===str[i]&&result++;return!(result%2)};exports.extract=function extract(from,what){var certName="",begin=from.indexOf(what)+what.length;if(begin>=0){for(var end=from.indexOf(", ",begin);end>0&&!checkQuotes(from.substr(begin,end-begin));)end=from.indexOf(", ",end+1);certName=end<0?from.substr(begin):from.substr(begin,end-begin)}return certName}},408:function(module,exports,__webpack_require__){__webpack_require__(409),__webpack_require__(546),module.exports=__webpack_require__(547)},464:function(module,exports){},547:function(module,exports,__webpack_require__){"use strict";(function(module){var _react=__webpack_require__(548);module._StorybookPreserveDecorators=!0,(0,_react.configure)([__webpack_require__(707),__webpack_require__(708)],module)}).call(this,__webpack_require__(62)(module))},707:function(module,exports){function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,module.exports=webpackEmptyContext,webpackEmptyContext.id=707},708:function(module,exports,__webpack_require__){var map={"./FileSignatureCriptoPro.stories.js":709};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=708},709:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FileSignatureCriptoPro=void 0;var _slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_react=(__webpack_require__(710),__webpack_require__(57)),_react2=_interopRequireDefault(_react),_addonActions=__webpack_require__(827),_src2=_interopRequireDefault(__webpack_require__(840));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={title:"Подпись файла",component:_src2.default};exports.FileSignatureCriptoPro=function FileSignatureCriptoPro(){var _useState=(0,_react.useState)(null),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1],_useState3=(0,_react.useState)(!1),_useState4=_slicedToArray(_useState3,2),clear=_useState4[0],setClear=_useState4[1],_useState5=(0,_react.useState)(!1),_useState6=_slicedToArray(_useState5,2),sign=_useState6[0],setSign=_useState6[1],_useState7=(0,_react.useState)(!1),_useState8=_slicedToArray(_useState7,2),fileNameSign=_useState8[0],setFileName=_useState8[1],changeSing=function changeSing(_ref2){var _ref2$sign=_ref2.sign,sign=void 0===_ref2$sign?null:_ref2$sign,_ref2$fileNameSign=_ref2.fileNameSign,fileNameSign=void 0===_ref2$fileNameSign?null:_ref2$fileNameSign;setSign(sign),setFileName(fileNameSign)};(0,_react.useEffect)((function(){clear&&(changeSing(),setClear(!1))}),[clear]);return _react2.default.createElement("div",null,_react2.default.createElement("h2",null,"Подписываем файл"),_react2.default.createElement("p",null,_react2.default.createElement("input",{type:"file",onChange:function fileInputHandler(_ref){var _ref$target$files=_ref.target.files,files=void 0===_ref$target$files?[]:_ref$target$files;file&&file!==files[0]&&setClear(!0),setFile(files[0])}})),_react2.default.createElement(_src2.default,{callback:function callback(e){changeSing(e),(0,_addonActions.action)("callback подписи")(e)},file:file,clear:clear,callbackError:(0,_addonActions.action)("callback ошибки")}),_react2.default.createElement("h2",null,fileNameSign),_react2.default.createElement("p",null,sign.toString()),_react2.default.createElement("button",{onClick:function onClick(){return setClear(!0)}}," Удалить подпись"))}},729:function(module,exports){},743:function(module,exports){},745:function(module,exports){},840:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _FileSignatureCriptoPro=__webpack_require__(841);Object.defineProperty(exports,"default",{enumerable:!0,get:function get(){return function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(_FileSignatureCriptoPro).default}})},841:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_react=__webpack_require__(57),_react2=_interopRequireDefault(_react),_cryptoProCadesplugin2=_interopRequireDefault(__webpack_require__(238)),_SelectCert2=_interopRequireDefault(__webpack_require__(851)),_utils=__webpack_require__(403);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=function FileSignatureCriptoPro(_ref){var _ref$callback=_ref.callback,callback=void 0===_ref$callback?function(_){return _}:_ref$callback,_ref$file=_ref.file,file=void 0===_ref$file?null:_ref$file,_ref$clear=_ref.clear,clear=void 0!==_ref$clear&&_ref$clear,_ref$callbackError=_ref.callbackError,callbackError=void 0===_ref$callbackError?function(_){return _}:_ref$callbackError,_useState=(0,_react.useState)(null),_useState2=_slicedToArray(_useState,2),thumbprint=_useState2[0],setThumbprint=_useState2[1],_useState3=(0,_react.useState)(null),_useState4=_slicedToArray(_useState3,2),sign=_useState4[0],setSign=_useState4[1],_useState5=(0,_react.useState)(null),_useState6=_slicedToArray(_useState5,2),fileNameSign=_useState6[0],setFileNameSign=_useState6[1],_useState7=(0,_react.useState)(null),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];clear&&(sign||fileNameSign)&&function cleanOut(){setSign(null),setFileNameSign(null),setError(null)}();(function useDoCertsAbout(){return(0,_react.useMemo)(function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise((function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then((function(value){step("next",value)}),(function(err){step("throw",err)}));resolve(value)}("next")}))}}(regeneratorRuntime.mark((function _callee(){var certsApi,about;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_cryptoProCadesplugin2.default;case 2:return certsApi=_context.sent,_context.next=5,certsApi.about();case 5:return about=_context.sent,_context.abrupt("return",about);case 7:case"end":return _context.stop()}}),_callee,void 0)}))),[])})().catch((function(e){setError("Плагин подписи не доступен"),console.log(e)}));return error&&callbackError(error),_react2.default.createElement("div",null,!sign&&file&&_react2.default.createElement(_SelectCert2.default,{setThumbprint:setThumbprint}),!error&&file&&!sign&&thumbprint&&_react2.default.createElement("button",{className:"button green",disabled:!thumbprint,onClick:function subscribe(){return(0,_utils.signFile)({thumbprint:thumbprint,file:file}).then((function(_ref3){var fileName=_ref3.fileName,blob=_ref3.blob;setSign(blob),setFileNameSign(fileName),callback({fileNameSign:fileNameSign,sign:sign})})).catch((function(e){return setError(String(e))}))}},"Подписать"))}},851:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_react=__webpack_require__(57),_react2=_interopRequireDefault(_react),_cryptoProCadesplugin2=_interopRequireDefault(__webpack_require__(238)),_Select2=_interopRequireDefault(__webpack_require__(852)),_utils=__webpack_require__(403);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var useDoCertsList=function useDoCertsList(){return(0,_react.useMemo)(function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise((function(resolve,reject){return function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then((function(value){step("next",value)}),(function(err){step("throw",err)}));resolve(value)}("next")}))}}(regeneratorRuntime.mark((function _callee(){var certsApi,certsList,list;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_cryptoProCadesplugin2.default;case 2:return certsApi=_context.sent,_context.next=5,certsApi.getCertsList();case 5:return certsList=_context.sent,list=certsList.map((function(_ref2){var subjectInfo=_ref2.subjectInfo;return{value:_ref2.thumbprint,label:(0,_utils.extract)(subjectInfo,"CN=")}})),_context.abrupt("return",list);case 8:case"end":return _context.stop()}}),_callee,void 0)}))),[])};exports.default=function SelectCert(_ref3){var setThumbprint=_ref3.setThumbprint,_useState=(0,_react.useState)([{value:"подпись",label:"подпись"}]),_useState2=_slicedToArray(_useState,2),listSert=_useState2[0],setListSert=_useState2[1],_useState3=(0,_react.useState)(null),_useState4=_slicedToArray(_useState3,2),selectItem=_useState4[0],setSelectItem=_useState4[1];useDoCertsList().then(setListSert),(0,_react.useEffect)((function(){setThumbprint(selectItem||listSert[0].value)}),[selectItem,listSert]);return _react2.default.createElement(_Select2.default,{defaultValue:listSert[0].value,label:"Выберите сертификат",name:"thumbprint",options:listSert,onChange:function onChange(_ref4){var value=_ref4.target.value;return setSelectItem(value)}})}},852:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RawSelect=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_react2=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__(57));var RawSelect=exports.RawSelect=function RawSelect(_ref){var value=_ref.value,_ref$options=_ref.options,options=void 0===_ref$options?[]:_ref$options,onChange=_ref.onChange;return _react2.default.createElement("div",{className:"filter_block_select select_list"},_react2.default.createElement("select",{className:"select",onChange:onChange},options.map((function(option){var optionValue=option&&option.value?option.value:option,optionLabel=option&&option.label?option.label:option;return _react2.default.createElement("option",{key:optionValue,value:optionValue,defaultValue:value===optionValue},optionLabel)}))))};exports.default=function Select(_ref2){var label=_ref2.label,other=function _objectWithoutProperties(obj,keys){var target={};for(var i in obj)keys.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(obj,i)&&(target[i]=obj[i]);return target}(_ref2,["label"]);return _react2.default.createElement("label",null,_react2.default.createElement("div",{className:"form_input_block"},label?_react2.default.createElement("div",{className:"form_txt_wrap"},_react2.default.createElement("span",{className:"f-size14 f-clrGrey"},label)):null,_react2.default.createElement(RawSelect,_extends({className:"select_bank_wrap"},other))))}}},[[408,1,2]]]);
//# sourceMappingURL=main.9d8fb9e21962d894688e.bundle.js.map